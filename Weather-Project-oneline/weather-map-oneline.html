<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Weather Map</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" type="text/css">
    <!--  <link href='/css/weather.css' rel='stylesheet'>-->

</head>
<body>

<script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
<script src="js/keys.js"></script>
<script src="js/mapbox-geocoder-utils.js"></script>
<script src="https://ajax.googleapis.com"></script>

<div class="container">
    <h1 style="">Weather Map</h1>
    <div class="card"></div>
</div>

<div id="geoMap" style="width: 85%; height: 600px"></div>

<script>
    let accessToken = MAPBOX_API_TOKEN
    mapboxgl.accessToken = accessToken;
    let map = new mapboxgl.Map({
        container: "geoMap", // container ID
        style: 'mapbox://styles/mapbox/outdoors-v12', // style URL
        center: [-98.50, 29.40], // starting position
        zoom: 12, // starting zoom
    });

    //Convert API data response to JS Date Object
    // new date (second ^ 1000) formula

    // Initial API Call
    function getWeather (lat, lng) {
        $.get('https://api.openweathermap.org/data/2.5/forcast', {
            appid: WEATHER_MAP_KEY,
            lat: lat,
            lon: lng,
            units: 'imperial',
            exclude: 'minutely,hourly',
        }).done(function weatherData(data) {
            console.log(data);

            //Current Weather
            // lat={lat}&lon={lon}&exclude={part}&appid={API key}

            //5-Day Forecast Loop

            let html = "";

            for (let i = 0; i < data.daily.length - 3; i++) {
                let weekDay = new Date(data.daily[i].dt * 1000);

                html += `
                <ul>
                    <h3>${new Intl.DateTimeFormat('en-US', { weekday: 'long' }).format(weekDay)}</h3>
                    <div><img src="https://openweathermap.org/img/wn/${data.daily[i].weather[0].icon}@2x.png"/></div>
                    <div style="text">Conditions</div>
                    <li>Temperature High  ${data.daily[i].temp.max}°F</li>
                     <li>Temperature Low  ${data.daily[i].temp.min}°F</li>
                    <li>Description: ${data.daily[i].weather[0].description}</li>
                    <li>Humidity: ${data.daily[i].humidity}%</li>
                    <li>Wind Speed: ${data.daily[i].wind_speed}</li>
                </ul>
            `;
            }

            console.log();
            $('.card').html(html);


        }).fail(function (error) {
            console.log(error);
        });

    }

    getWeather()

    // Add the control to the map.
    map.addControl(
        new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl
        })
        );

    const marker = new mapboxgl.Marker({
        draggable: true
    })
        .setLngLat([-98.489615, 29.426827])
        .addTo(map);

    function onDragEnd() {
        const lngLat = marker.getLngLat();
        coordinates.style.display = 'block';
        coordinates.innerHTML = `Longitude: ${lngLat.lng}<br/>Latitude: ${lngLat.lat}`;
        // alert(lngLat);
    }

    marker.on('dragend', onDragEnd);

    map.on('moveend', () => {
        let coordinates = map.getCenter();
        // console.log(coordinates);
        getWeather(coordinates.lat, coordinates.lng)
    });

</script>

</body>
</html>

<!--### Output (70%)-->
<!-- Shows current weather in city student lives in-->

<!--X Shows at least four days of forecasts for city student lives in (total of five days including current weather)-->

<!--X Page includes map with a marker on the location that the weather is shown for-->

<!--___ User may move the marker by dragging, or may click on the map to add a new marker, in which case the old marker should disappear.  Only one marker should be on the map at any given moment.-->

<!--___ Weather forecast updates when marker is moved or replaced.-->

<!-- Text input is present that allows user to search for a place, and the forecast updates to the place the user searched for.  Note: marker updating to the place the user searches for is not required (it's a bonus)-->

<!--___ Project is cohesively styled-->
<!--### Code Quality (30%)-->

<!--X Code is organized according to best practices.  There is a css and a js folder, no css or js on the html page-->

<!--X Code is formatted consistently with comments and whitespace making it easy to understand where each part of the code is-->

<!--___ Effective use of functions to encapsulate code-->

